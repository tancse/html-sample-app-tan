pipeline{
    agent any //selection of agents
    // defining environment variables
    environment{
        SONAR_HOME = 'C:\\Users\\Administrator\\Documents\\tools\\sonar-scanner\\bin'
        REPO_NAME = 'https://github.com/tancse/html-sample-app-tan.git'
        BRANCH_NAME = 'master'
        SONAR_TOKEN = credentials('html-css-app-tan-pro3')
    }
    stages{
        //stage 1
        stage('testing and verify required command'){
            steps{
                echo 'hello world'
                //bat or pwsh
                bat """ 
                %SONAR_HOME%\\sonar-scanner --version
                echo == checking docker ===>
                docker version
                echo == java version ===>
                java --version
                """
            }
        }
        //git checkout
        stage('takign code of github repo'){
            steps{
                echo 'cloning repo'
                git url:"${REPO_NAME}", branch:"${BRANCH_NAME}"
            }
        }
        // doing sast with sonarqube
        stage('SAST with Sonar-scanner'){
            steps{
                echo 'wait for sonar-scanner to finish'
                bat """
                %SONAR_HOME%\\sonar-scanner \
                -Dsonar.projectKey=tan_devops_d3 \
                -Dsonar.sources=. \
                -Dsonar.host.url=http://13.203.151.240:9000 \
                -Dsonar.token=${SONAR_TOKEN}
                """
            }
        }
        
    }
}